<?xml version="1.0" encoding="UTF-8"?>
<graphSchema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../datastream-1.0.xsd">

    <objectCollection name="dataset">

        <objectGraph name="system" class="org.msh.etbm.entities.ServerSignature" />
        
        <objectGraph name="workspace" class="org.msh.etbm.entities.Workspace">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="view" use="IGNORE" />
            <property name="users" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="version" class="org.msh.etbm.entities.EntityLastVersion">
            <property name="entityClass" elementName="entity" xmlAttribute="true" />
            <property name="lastVersion" elementName="number" xmlAttribute="true" />
        </objectGraph>
        
        <objectGraph name="userprofile" class="org.msh.etbm.entities.UserProfile">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="permissions">
                <objectGraph name="permission" class="org.msh.etbm.entities.UserPermission" parentProperty="userProfile">
                    <property name="userRole.id" elementName="role_id" use="REQUIRED" xmlAttribute="true"/>
                    <property name="id" use="REQUIRED" xmlAttribute="true"/>
                    <property name="canChange" use="REQUIRED" xmlAttribute="true"/>
                    <property name="canExecute" use="REQUIRED" xmlAttribute="true"/>
                    <property name="grantPermission" elementName="grant" use="REQUIRED" xmlAttribute="true"/>
                    <property name="caseClassification" elementName="classif" xmlAttribute="true"/>
                </objectGraph>
            </property>
            <property name="workspace" use="IGNORE" />
        </objectGraph>

        <objectGraph name="countrystructure" class="org.msh.etbm.entities.CountryStructure">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="level" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name2" elementName="name2" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="adminunit" class="org.msh.etbm.entities.AdministrativeUnit">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" xmlAttribute="true"/>
            <property name="name.name2" elementName="name2" xmlAttribute="true"/>
            <property name="countryStructure.id" elementName="struct" use="REQUIRED" xmlAttribute="true" />
            <property name="code" xmlAttribute="true" use="REQUIRED" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="parent.id" elementName="parent_id" xmlAttribute="true" />
            <property name="unitsCount" xmlAttribute="true" />
            <property name="units" use="IGNORE" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="healthsys" class="org.msh.etbm.entities.HealthSystem">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="source" class="org.msh.etbm.entities.Source">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="abbrevName.name1" elementName="abbrevname1" use="REQUIRED" />
            <property name="abbrevName.name2" elementName="abbrevname2" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="tbunit" class="org.msh.etbm.entities.Tbunit">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="adminUnit.id" elementName="adminunit" use="NOT_REQUIRED"/>
            <property name="firstLineSupplier.id" elementName="firstlinesupplier" />
            <property name="secondLineSupplier.id" elementName="secondlinesupplier" />
            <property name="authorizerUnit.id" elementName="authorizer" />
            <property name="healthSystem.id" elementName="healthSystem" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>

        <objectGraph name="unit-link" class="org.msh.etbm.desktop.databases.TBUnitLinks">
        </objectGraph>
        
        <objectGraph name="substance" class="org.msh.etbm.entities.Substance">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="abbrevName.name1" elementName="abbrevname1" use="REQUIRED" />
            <property name="abbrevName.name2" elementName="abbrevname2" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="medicine" class="org.msh.etbm.entities.Medicine">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="genericName.name1" elementName="name1" use="REQUIRED" />
            <property name="genericName.name2" elementName="name2" />
            <property name="abbrevName" elementName="abbrevname" use="REQUIRED" />
            <property name="components">
                <objectGraph name="component" class="org.msh.etbm.entities.MedicineComponent" parentProperty="medicine">
                    <property name="id" xmlAttribute="true" />
                    <property name="substance.id" elementName="substance" xmlAttribute="true" />
                    <property name="strength" xmlAttribute="true" />
                </objectGraph>
            </property>
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="lab" class="org.msh.etbm.entities.Laboratory">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name" elementName="name" use="REQUIRED" />
            <property name="abbrevName" elementName="abbrevName" use="REQUIRED"/>
            <property name="adminUnit.id" elementName="adminunit" />
            <property name="healthSystem.id" elementName="healthsystem" />
            <property name="legacyId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>
        
        <objectGraph name="field" class="org.msh.etbm.entities.FieldValue">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name.name1" elementName="name1" use="REQUIRED" />
            <property name="name.name2" elementName="name2" />
            <property name="shortName.name1" elementName="shortname1" use="REQUIRED" />
            <property name="shortName.name2" elementName="shortname2" />
            <property name="field" xmlAttribute="true" />
            <property name="other" xmlAttribute="true" />
            <property name="displayOrder" xmlAttribute="true" />
            <property name="customId" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>

        <!-- TREATMENT REGIMEN -->
        <objectGraph name="regimen" class="org.msh.etbm.entities.Regimen">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="medicines">
                <objectGraph name="medicine" class="org.msh.etbm.entities.MedicineRegimen" parentProperty="regimen">
                    <property name="id" xmlAttribute="true" />
                    <property name="medicine.id" elementName="medicine" />
                    <property name="defaultSource.id" elementName="source" />
                </objectGraph>
            </property>
            <property name="workspace" use="IGNORE" />
            <property name="intensivePhaseMedicines" use="IGNORE" />
            <property name="continuousPhaseMedicines" use="IGNORE" />
        </objectGraph>
        
		<!-- USERS -->
        <objectGraph name="userws" class="org.msh.etbm.entities.UserWorkspace">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="healthSystem.id" elementName="healthsystem" xmlAttribute="true" />
            <property name="tbunit.id" elementName="tbunit" xmlAttribute="true" />
            <property name="profile.id" elementName="profile" xmlAttribute="true" />
            <property name="adminUnit.id" elementName="adminunit" xmlAttribute="true" />
            <property name="user">
                <objectGraph name="user" class="org.msh.etbm.entities.User">
            		<property name="id" xmlAttribute="true" use="REQUIRED" />
            		<property name="login" xmlAttribute="true" use="REQUIRED" />
            		<property name="parentUser.id" use="IGNORE" />
            		<property name="defaultWorkspace" use="IGNORE" />
            		<property name="workspaces" use="IGNORE" />
                </objectGraph>
            </property>
            <property name="workspace" use="IGNORE" />
        </objectGraph>

        
        <objectGraph name="tag" class="org.msh.etbm.entities.Tag">
            <property name="id" xmlAttribute="true" use="REQUIRED" />
            <property name="name" elementName="name1" use="REQUIRED" />
            <property name="sqlCondition" xmlAttribute="true" />
            <property name="consistencyCheck" xmlAttribute="true" />
            <property name="active" xmlAttribute="true" />
            <property name="dailyUpdate" xmlAttribute="true" />
            <property name="workspace" use="IGNORE" />
        </objectGraph>


        <!-- TB CASES -->
        <objectGraph name="tbcase" class="org.msh.etbm.custom.bd.entities.TbCaseBD">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="version" use="IGNORE" />
            <property name="patient" >
                <objectGraph name="patient" class="org.msh.etbm.entities.Patient">
            		<property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            		<property name="cases" use="IGNORE" />
            		<property name="workspace" use="IGNORE" />
            		<property name="name.name" elementName="name" />
            		<property name="name.middleName" elementName="middleName" />
            		<property name="name.lastName" elementName="lastName" />
            	</objectGraph>
            </property>
            <property name="classification" xmlAttribute="true" />
            <property name="state" xmlAttribute="true" />
            <property name="patientType" xmlAttribute="true" />
            <property name="diagnosisType" xmlAttribute="true" />
            <property name="infectionSite" xmlAttribute="true" />
            <property name="treatmentPeriod.iniDate" elementName="iniTreatDate"/>
            <property name="treatmentPeriod.endDate" elementName="endTreatDate"/>
            <property name="regimen.id" elementName="regimen" />
            <property name="regimenIni.id" elementName="regimenini" />
            <property name="ownerUnit.id" elementName="ownerunit" xmlAttribute="true"/>
            <property name="pulmonaryType.id" elementName="pulmonaryType" />
            <property name="extrapulmonaryType.value" elementName="extrapulmonaryType" />
            <property name="extrapulmonaryType.complement" elementName="extrapulmonaryTypeCompl" />
            <property name="extrapulmonaryType2.value" elementName="extrapulmonaryType2" />
            <property name="extrapulmonaryType2.complement" elementName="extrapulmonaryType2Compl" />
            <property name="notificationUnit.id" elementName="notificationUnit" />
            <property name="healthUnits">
                <objectGraph name="healthunit" class="org.msh.etbm.entities.TreatmentHealthUnit" parentProperty="tbcase">
                    <property name="tbunit.id" elementName="tbunit" use="REQUIRED" xmlAttribute="true"/>
                    <property name="transferring" elementName="transf" xmlAttribute="true" />
                    <property name="period.iniDate" elementName="iniDate" use="REQUIRED" />
                    <property name="period.endDate" elementName="endDate" use="REQUIRED" />
                </objectGraph>
            </property>
            <property name="prescribedMedicines" >
                <objectGraph name="presc-med" class="org.msh.etbm.entities.PrescribedMedicine" parentProperty="tbcase">
                    <property name="medicine.id" elementName="medicine" use="REQUIRED" xmlAttribute="true"/>
                    <property name="period.iniDate" elementName="iniDate" use="REQUIRED" />
                    <property name="period.endDate" elementName="endDate" use="REQUIRED" xmlAttribute="true"/>
                    <property name="source.id" elementName="source" use="REQUIRED" />
                    <property name="doseUnit" use="REQUIRED" xmlAttribute="true"/>
                    <property name="frequency" use="REQUIRED" xmlAttribute="true"/>
                </objectGraph>
            </property>
            <property name="sideEffects" use="IGNORE" />
            <property name="comorbidities">
                <objectGraph name="comorbidity" class="org.msh.etbm.entities.CaseComorbidity" parentProperty="tbcase">
                    <property name="comorbidity.id" elementName="comorbidity" use="REQUIRED" xmlAttribute="true"/>
                    <property name="duration" xmlAttribute="true" />
                </objectGraph>
            </property>
            <property name="examinations" use="IGNORE" />
            <property name="resXRay" use="IGNORE" />
            <property name="contacts" use="IGNORE" />
            <property name="treatmentMonitoring" use="IGNORE"/>
            <property name="resHIV" use="IGNORE" />
            <property name="examsCulture" use="IGNORE" />
            <property name="examsMicroscopy" use="IGNORE" />
            <property name="examsDST" use="IGNORE" />
            <property name="tags" use="IGNORE" />
            <property name="patientRefToFv.id" elementName="patientRefToFv" />
        </objectGraph>
        
        <objectGraph name="examdst" class="org.msh.etbm.entities.ExamDST">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="numResistant" use="IGNORE" />
            <property name="numContaminated" use="IGNORE" />
            <property name="numSusceptible" use="IGNORE" />
            <property name="results">
                <objectGraph name="dstresult" class="org.msh.etbm.entities.ExamDSTResult" parentProperty="exam">
                    <property name="substance.id" elementName="substance" use="REQUIRED" xmlAttribute="true"/>
                    <property name="result" use="REQUIRED" xmlAttribute="true"/>
                </objectGraph>
            </property>
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
            <property name="method.id" elementName="method" xmlAttribute="true"/>
        </objectGraph>
        
        <objectGraph name="exammicroscopy" class="org.msh.etbm.entities.ExamMicroscopy">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
            <property name="method.id" elementName="method" xmlAttribute="true"/>
        </objectGraph>
        
        <objectGraph name="examculture" class="org.msh.etbm.entities.ExamCulture" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
            <property name="method.id" elementName="method" xmlAttribute="true"/>
        </objectGraph>

        <objectGraph name="examxpert" class="org.msh.etbm.entities.ExamXpert">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED"/>
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
        </objectGraph>
        
        <objectGraph name="examhiv" class="org.msh.etbm.entities.ExamHIV">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
        </objectGraph>
        
        <objectGraph name="address" class="org.msh.etbm.entities.Address">
            <property name="adminUnit.id" elementName="adminunit" />
        </objectGraph>
        
        <objectGraph name="contact" class="org.msh.etbm.entities.TbContact" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="contactType.id" elementName="contactType" />
            <property name="conduct.id" elementName="conduct" />
        </objectGraph>
        
        <objectGraph name="examxray" class="org.msh.etbm.entities.ExamXRay">
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="presentation.id" elementName="presentation" />
        </objectGraph>
        
        <objectGraph name="medexam" class="org.msh.etbm.custom.bd.entities.MedicalExaminationBD" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dotTypeFv.id" elementName="dotTypeFv" />
        </objectGraph>
        
        <objectGraph name="sideEffect" class="org.msh.etbm.custom.bd.entities.CaseSideEffectBD" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="sideEffect.value.id" elementName="sideeffect" xmlAttribute="true"/>
            <property name="sideEffect.complement" elementName="complement" />
            <property name="substance.id" elementName="substance" />
            <property name="substance2.id" elementName="substance2" />
        </objectGraph>
        
        <objectGraph name="casetag" class="org.msh.etbm.sync.CaseTag">
            <property name="caseId" xmlAttribute="true" use="REQUIRED" />
            <property name="tagId" xmlAttribute="true" use="REQUIRED" />
        </objectGraph>
        
        <objectGraph name="entityKey" class="org.msh.etbm.sync.EntityKey">
            <property name="entityName" elementName="entity" xmlAttribute="true" />
            <property name="serverId" xmlAttribute="true" />
            <property name="clientId" xmlAttribute="true" />
            <property name="action" xmlAttribute="true" />
        </objectGraph>
        
        <objectGraph name="deleted-entity" class="org.msh.etbm.entities.DeletedEntity">
            <property name="entityName" elementName="entity" xmlAttribute="true" />
            <property name="entityId" elementName="serverId" xmlAttribute="true" />
        </objectGraph>

        <objectGraph name="examskin" class="org.msh.etbm.custom.bd.entities.ExamSkin" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
            <property name="method.id" elementName="method" xmlAttribute="true"/>
        </objectGraph>

        <objectGraph name="exambiopsy" class="org.msh.etbm.custom.bd.entities.ExamBiopsy" >
            <property name="syncData.serverId" elementName="id" xmlAttribute="true" use="REQUIRED" />
            <property name="tbcase.syncData.serverId" elementName="tbcase" use="REQUIRED" xmlAttribute="true" />
            <property name="dateCollected" xmlAttribute="true" />
            <property name="result" xmlAttribute="true" />
            <property name="laboratory.id" elementName="lab" xmlAttribute="true"/>
            <property name="method.id" elementName="method" xmlAttribute="true"/>
        </objectGraph>
        
    </objectCollection>
</graphSchema>
